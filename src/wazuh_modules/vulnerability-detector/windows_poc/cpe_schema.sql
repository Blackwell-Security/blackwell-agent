BEGIN;

CREATE TABLE IF NOT EXISTS `NVD_METADATA` (
    `YEAR` integer primary key,
    `CREATED` integer,
    `UPDATED` integer,
    `URL` text,
    `HASH` text,
    `LAST_MODIFIED` integer not null
);

CREATE TABLE IF NOT EXISTS `NVD_CVE` (
    `ID` integer primary key autoincrement,
    `NVD_METADATA_YEAR` integer,
    `CVE_ID` text not null,
    `CWE_ID` text,
    `DESCRIPTION` text,
    `PUBLISHED` integer,
    `LAST_MODIFIED` integer
);

CREATE TABLE IF NOT EXISTS `NVD_METRIC_CVSS` (
    `ID` integer primary key autoincrement,
    `NVD_CVE_ID` integer,
    `VERSION` text,
    `VECTOR_STRING` text,
    `BASE_SCORE` real,
    `EXPLOITABILITY_SCORE` real,
    `IMPACT_SCORE` real
);

CREATE TABLE IF NOT EXISTS `NVD_REFERENCE` (
    `ID` integer primary key autoincrement,
    `NVD_CVE_ID` integer,
    `URL` text,
    `REF_SOURCE` text
);

CREATE TABLE IF NOT EXISTS `NVD_CVE_CONFIGURATION` (
    `ID` integer primary key autoincrement,
    `NVD_CVE_ID` integer,
    `PARENT` integer default 0,
    `OPERATOR` text
);

CREATE TABLE IF NOT EXISTS `NVD_CVE_MATCH` (
    `ID` integer primary key autoincrement,
    `NVD_CVE_CONFIGURATION_ID` integer,
    `VULNERABLE` text,
    `URI` text,
    `VERSION_START_INCLUDING` text,
    `VERSION_START_EXCLUDING` text,
    `VERSION_END_INCLUDING` text,
    `VERSION_END_EXCLUDING` text
);

CREATE TABLE IF NOT EXISTS `NVD_MATCH_CPE` (
    `ID_MATCH` integer,
    `ID_CPE` integer,
    primary key(`ID_MATCH`, `ID_CPE`)
);

CREATE TABLE IF NOT EXISTS `NVD_CPE` (
    `PART` text,
    `VENDOR` text,
    `PRODUCT` text,
    `VERSION` text,
    `UPDATED` text,
    `EDITION` text,
    `LANGUAGE` text,
    `SW_EDITION` text,
    `TARGET_SW` text,
    `TARGET_HW` text,
    `OTHER` text,
    primary key(`PART`, `VENDOR`, `PRODUCT`, `VERSION`, `UPDATED`, `EDITION`, `LANGUAGE`, `SW_EDITION`, `TARGET_SW`, `OTHER`)
);

CREATE TABLE IF NOT EXISTS `AGENTS` (
     `AGENT_ID` int not null,
     `CPE_INDEX_ID` int default 0,
     `VENDOR` text not null,
     `PACKAGE_NAME` text not null,
     `VERSION` text not null,
     `ARCH` text not null,
     primary key(`AGENT_ID`, `VENDOR`, `PACKAGE_NAME`, `VERSION`, `ARCH`)
);

CREATE TABLE IF NOT EXISTS `CPE_INDEX` (
	`ID` integer primary key autoincrement,
    `PART` text,
    `VENDOR` text not null,
    `PRODUCT` text not null,
    `VERSION` text not null,
    `UPDATEV` text,
    `EDITION` text,
    `LANGUAGE` text,
    `SW_EDITION` text,
    `TARGET_SW` text,
    `TARGET_HW` text,
    `OTHER` text
);

CREATE INDEX IF NOT EXISTS `IDX_METADATA_LASTMOD` ON `NVD_METADATA`(`LAST_MODIFIED`);
CREATE INDEX IF NOT EXISTS `IDX_METADATA_LASTMOD` ON `NVD_METADATA`(`YEAR`);
CREATE INDEX IF NOT EXISTS `IDX_NVD_CVE_ID` ON `NVD_CVE`(`ID`);
CREATE INDEX IF NOT EXISTS `IDX_CVSS_NVDCVE_ID` ON `NVD_METRIC_CVSS`(`NVD_CVE_ID`);
CREATE INDEX IF NOT EXISTS `IDX_REF_NVDCVE_ID` ON `NVD_REFERENCE`(`NVD_CVE_ID`);
CREATE INDEX IF NOT EXISTS `IDX_MATCH_NVDCVE_ID` ON `NVD_CVE_MATCH`(`NVD_CVE_CONFIGURATION_ID`);
CREATE INDEX IF NOT EXISTS `CPE_ID` ON `CPE_INDEX`(`ID`);
CREATE INDEX IF NOT EXISTS `CPE_VENDOR` ON `CPE_INDEX`(`VENDOR`);
CREATE INDEX IF NOT EXISTS `CPE_PRODUCT` ON `CPE_INDEX`(`PRODUCT`);
CREATE INDEX IF NOT EXISTS `CPE_VERSION` ON `CPE_INDEX`(`VERSION`);

END;
